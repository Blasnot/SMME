PSEUDOCÓDIGO: SISTEMA MODULAR DE MONITORAMENTO ENERGÉTICO (SMME)
total de seções: 8


// Seção 1: Configurações Iniciais do Sistema
INICIO CONFIGURACOES_INICIAIS
    DEFINIR APARÊNCIA_TEMA COMO 'escuro'
    DEFINIR APARÊNCIA_CORES COMO 'azul'
    DEFINIR CAMINHO_BANCO_DADOS COMO CAMINHO_ABSOLUTO('smme.db')
FIM CONFIGURACOES_INICIAIS


// Seção 2: Funções de Manipulação do Banco de Dados

FUNCAO CONECTAR_BD()
    RETORNA CONEXAO_BANCO_DADOS(CAMINHO_BANCO_DADOS) COM LINHAS_COMO_DICIONARIO
FIM FUNCAO

FUNCAO CONFIGURAR_BANCO_DE_DADOS()
    CONEXAO = CONECTAR_BD()
    CURSOR = CONEXAO.OBTER_CURSOR()

    // Criar Tabela USUARIOS
    SE Tabela 'usuarios' NAO EXISTE ENTAO
        CRIAR TABELA usuarios (
            id INTEIRO CHAVE_PRIMARIA AUTO_INCREMENTO,
            username TEXTO NAO_NULO UNICO,
            password TEXTO NAO_NULO,
            cargo TEXTO
        )
    FIM SE

    // Criar Tabela SETORES
    SE Tabela 'setores' NAO EXISTE ENTAO
        CRIAR TABELA setores (
            id INTEIRO CHAVE_PRIMARIA AUTO_INCREMENTO,
            nome TEXTO NAO_NULO UNICO
        )
    FIM SE

    // Criar Tabela DISPOSITIVOS
    SE Tabela 'dispositivos' NAO EXISTE ENTAO
        CRIAR TABELA dispositivos (
            id INTEIRO CHAVE_PRIMARIA AUTO_INCREMENTO,
            nome TEXTO NAO_NULO,
            info TEXTO,
            setor_id INTEIRO NAO_NULO REFERENCIA setores(id)
        )
    FIM SE

    // Criar Tabela SOLICITACOES_SERVICO
    SE Tabela 'solicitacoes_servico' NAO EXISTE ENTAO
        CRIAR TABELA solicitacoes_servico (
            id TEXTO CHAVE_PRIMARIA,
            titulo TEXTO NAO_NULO,
            descricao TEXTO,
            local TEXTO,
            categoria TEXTO,
            tecnico_atribuido TEXTO,
            status TEXTO PADRAO 'Aberta'
        )
    FIM SE

    // Preenchimento Inicial de Dados
    SE CONTAR_LINHAS('usuarios') == 0 ENTAO
        INSERIR_MUITOS EM 'usuarios' (username, password, cargo) VALORES (LISTA_DE_USUARIOS_INICIAIS)
    FIM SE

    SE CONTAR_LINHAS('setores') == 0 ENTAO
        PARA CADA SETOR_NOME, DISPOSITIVOS EM LISTA_DE_SETORES_E_DISPOSITIVOS_INICIAIS:
            INSERIR EM 'setores' (nome) VALORES (SETOR_NOME)
            SETOR_ID = ULTIMO_ID_INSERIDO
            PARA CADA DISPOSITIVO EM DISPOSITIVOS:
                INSERIR EM 'dispositivos' (nome, info, setor_id) VALORES (DISPOSITIVO.nome, DISPOSITIVO.info, SETOR_ID)
    FIM SE

    SE CONTAR_LINHAS('solicitacoes_servico') == 0 ENTAO
        INSERIR_MUITOS EM 'solicitacoes_servico' (id, titulo, descricao, local, categoria, tecnico_atribuido, status) VALORES (LISTA_DE_SOLICITACOES_INICIAIS)
    FIM SE

    CONEXAO.COMMIT()
    CONEXAO.FECHAR()
FIM FUNCAO


// Seção 3: Variáveis Globais de Estado
VARIAVEL GLOBAL SETOR_ATUAL = NULO
VARIAVEL GLOBAL DISPOSITIVO_ATUAL = NULO
VARIAVEL GLOBAL USUARIO_ATUAL = NULO
VARIAVEL GLOBAL GRAFICO_ATUAL = NULO
VARIAVEL GLOBAL ID_SOLICITACAO_ATUAL = NULO


// Seção 4: Funções de Carregamento de Dados para a Interface

FUNCAO CARREGAR_TECNICOS_DISPONIVEIS()
    CONEXAO = CONECTAR_BD()
    RESULTADOS = CONSULTAR CONEXAO 'SELECT username FROM usuarios WHERE cargo LIKE "%Técnico%"'
    CONEXAO.FECHAR()
    RETORNA LISTA_DE_NOMES_DE_USUARIO_DOS_RESULTADOS
FIM FUNCAO

FUNCAO CARREGAR_CATEGORIAS_SERVICO()
    RETORNA ['Hardware', 'Software', 'Rede', 'Segurança', 'Manutenção Geral', 'Outros']
FIM FUNCAO

FUNCAO CARREGAR_LOCAIS_SERVICO()
    CONEXAO = CONECTAR_BD()
    RESULTADOS = CONSULTAR CONEXAO 'SELECT nome FROM setores'
    CONEXAO.FECHAR()
    RETORNA LISTA_DE_NOMES_DE_SETOR_DOS_RESULTADOS
FIM FUNCAO


// Seção 5: Funções de Funcionalidade da Aplicação

FUNCAO VALIDAR_LOGIN(usuario_digitado, senha_digitada)
    CONEXAO = CONECTAR_BD()
    USUARIO_ENCONTRADO = CONSULTAR CONEXAO 'SELECT username, cargo FROM usuarios WHERE username = ? AND password = ?' COM (usuario_digitado, senha_digitada)
    CONEXAO.FECHAR()

    SE USUARIO_ENCONTRADO EXISTE ENTAO
        USUARIO_ATUAL = { 'username': USUARIO_ENCONTRADO.username, 'cargo': USUARIO_ENCONTRADO.cargo }
        EXIBIR_MENSAGEM_LOGIN('Login feito com sucesso!', COR_VERDE)
        LIMPAR CAMPO_USUARIO
        LIMPAR CAMPO_SENHA
        AGUARDAR 1000ms
        CHAMAR MOSTRAR_TELA(TELA_SETORES)
    SENAO
        EXIBIR_MENSAGEM_LOGIN('Credenciais incorretas', COR_VERMELHA)
        LIMPAR CAMPO_SENHA
    FIM SE
FIM FUNCAO

FUNCAO MOSTRAR_TELA(tela_a_mostrar)
    SE GRAFICO_ATUAL EXISTE ENTAO
        DESTRUIR GRAFICO_ATUAL
        GRAFICO_ATUAL = NULO
        EXIBIR_COMPONENTE CAIXA_TEXTO_RELATORIO
    FIM SE

    PARA CADA TELA EM [TELA_LOGIN, TELA_SETORES, TELA_DISPOSITIVOS, TELA_RELATORIO, TELA_SOLICITACOES, TELA_SR_DETALHES]:
        OCULTAR TELA
    FIM PARA
    EXIBIR TELA_A_MOSTRAR (EXPANDIDA)
FIM FUNCAO

FUNCAO SELECIONAR_SETOR(nome_setor)
    SETOR_ATUAL = nome_setor
    CHAMAR PREENCHER_TELA_DISPOSITIVOS()
    CHAMAR MOSTRAR_TELA(TELA_DISPOSITIVOS)
FIM FUNCAO

FUNCAO SELECIONAR_DISPOSITIVO(dados_dispositivo)
    DISPOSITIVO_ATUAL = dados_dispositivo
    CHAMAR PREENCHER_TELA_RELATORIO()
    CHAMAR MOSTRAR_TELA(TELA_RELATORIO)
FIM FUNCAO

FUNCAO VOLTAR_PARA_SETORES()
    CHAMAR MOSTRAR_TELA(TELA_SETORES)
FIM FUNCAO

FUNCAO VOLTAR_PARA_DISPOSITIVOS()
    CHAMAR PREENCHER_TELA_DISPOSITIVOS()
    CHAMAR MOSTRAR_TELA(TELA_DISPOSITIVOS)
FIM FUNCAO

FUNCAO IR_PARA_SOLICITACOES_SERVICO()
    DEFINIR_VALOR_BOTAO_SEGMENTADO_SR("Visualizar Solicitações")
    CHAMAR MOSTRAR_SECAO_SR("Visualizar Solicitações")
    CHAMAR MOSTRAR_TELA(TELA_SOLICITACOES)
FIM FUNCAO

FUNCAO VOLTAR_PARA_SOLICITACOES_PRINCIPAL()
    CHAMAR IR_PARA_SOLICITACOES_SERVICO()
FIM FUNCAO

FUNCAO FILTRAR_DADOS()
    SE GRAFICO_ATUAL EXISTE ENTAO
        DESTRUIR GRAFICO_ATUAL
        GRAFICO_ATUAL = NULO
        EXIBIR_COMPONENTE CAIXA_TEXTO_RELATORIO
    FIM SE

    SE DISPOSITIVO_ATUAL EXISTE ENTAO
        LIMPAR CAIXA_TEXTO_RELATORIO
        INSERIR_TEXTO CAIXA_TEXTO_RELATORIO "Informações filtradas para '{DISPOSITIVO_ATUAL.nome}' do '{SETOR_ATUAL}':\n\n"
        INSERIR_TEXTO CAIXA_TEXTO_RELATORIO "Filtro aplicado: Dados dos últimos 7 dias.\nExemplo: Consumo médio de 450W/h, pico de 600W/h.\nNenhum alerta crítico encontrado nos últimos 7 dias após filtragem."
    SENAO
        LIMPAR CAIXA_TEXTO_RELATORIO
        INSERIR_TEXTO CAIXA_TEXTO_RELATORIO "Nenhum dispositivo selecionado para filtrar dados."
    FIM SE
FIM FUNCAO

FUNCAO CONSULTAR_DADOS()
    SE GRAFICO_ATUAL EXISTE ENTAO
        DESTRUIR GRAFICO_ATUAL
        GRAFICO_ATUAL = NULO
        EXIBIR_COMPONENTE CAIXA_TEXTO_RELATORIO
    FIM SE

    SE DISPOSITIVO_ATUAL EXISTE ENTAO
        LIMPAR CAIXA_TEXTO_RELATORIO
        INSERIR_TEXTO CAIXA_TEXTO_RELATORIO "Resultado da consulta para '{DISPOSITIVO_ATUAL.nome}' do '{SETOR_ATUAL}':\n\n"
        INSERIR_TEXTO CAIXA_TEXTO_RELATORIO "Consulta de desempenho: {DISPOSITIVO_ATUAL.nome} operou com 95% de eficiência no último mês.\nÚltimo registro de erro: 12/06/2025 - Erro de comunicação (resolvido)."
    SENAO
        LIMPAR CAIXA_TEXTO_RELATORIO
        INSERIR_TEXTO CAIXA_TEXTO_RELATORIO "Nenhum dispositivo selecionado para consultar dados."
    FIM SE
FIM FUNCAO

FUNCAO GERAR_RELATORIO()
    SE GRAFICO_ATUAL EXISTE ENTAO
        DESTRUIR GRAFICO_ATUAL
        GRAFICO_ATUAL = NULO
        EXIBIR_COMPONENTE CAIXA_TEXTO_RELATORIO
    FIM SE

    SE DISPOSITIVO_ATUAL EXISTE ENTAO
        LIMPAR CAIXA_TEXTO_RELATORIO
        INSERIR_TEXTO CAIXA_TEXTO_RELATORIO "Relatório completo para '{DISPOSITIVO_ATUAL.nome}' do '{SETOR_ATUAL}':\n\n"
        INSERIR_TEXTO CAIXA_TEXTO_RELATORIO DISPOSITIVO_ATUAL.info
        INSERIR_TEXTO CAIXA_TEXTO_RELATORIO "\n\n--- Fim do Relatório ---"
    SENAO
        LIMPAR CAIXA_TEXTO_RELATORIO
        INSERIR_TEXTO CAIXA_TEXTO_RELATORIO "Nenhum dispositivo selecionado para gerar relatório."
    FIM SE
FIM FUNCAO

FUNCAO MOSTRAR_GRAFICO()
    SE NAO DISPOSITIVO_ATUAL EXISTE ENTAO
        LIMPAR CAIXA_TEXTO_RELATORIO
        INSERIR_TEXTO CAIXA_TEXTO_RELATORIO "Selecione um dispositivo para ver os gráficos de dados."
        SE GRAFICO_ATUAL EXISTE ENTAO
            DESTRUIR GRAFICO_ATUAL
            GRAFICO_ATUAL = NULO
        FIM SE
        RETORNA
    FIM SE

    OCULTAR_COMPONENTE CAIXA_TEXTO_RELATORIO

    SE GRAFICO_ATUAL EXISTE ENTAO
        DESTRUIR GRAFICO_ATUAL
    FIM SE

    // Dados de exemplo para o gráfico
    HORAS = ARRAY_DE_0_A_23
    CONSUMO_BASE = DADOS_ALEATORIOS(50, 10, 24)
    PICO_MANHA = DADOS_ALEATORIOS(150, 20, 3)
    PICO_TARDE = DADOS_ALEATORIOS(180, 25, 4)
    CONSUMO = CONSUMO_BASE
    CONSUMO[7:10] += PICO_MANHA
    CONSUMO[13:17] += PICO_TARDE
    CONSUMO = MAXIMO(0, CONSUMO)

    // Criar e configurar gráfico Matplotlib
    FIGURA, EIXO = CRIAR_SUBPLOTS_MATPLOTLIB(TAMANHO=(7, 4))
    EIXO.PLOTAR(HORAS, CONSUMO, MARCADOR='o', ESTILO_LINHA='-', COR='#2D88FF')
    EIXO.SET_TITULO('Consumo Energético de ' + DISPOSITIVO_ATUAL.nome + ' (Últimas 24h)', COR='white')
    EIXO.SET_LABELS('Hora do Dia', 'Consumo (Watts)', COR='white')
    EIXO.SET_TICKS(HORAS)
    EIXO.SET_GRADE(VERDADEIRO)

    // Definir cores de fundo e texto do gráfico conforme tema da interface
    SE TEMA_APARENCIA_ATUAL == "Dark" ENTAO
        COR_FUNDO = "#242424"
    SENAO
        COR_FUNDO = "#dbdbdb"
    FIM SE
    FIGURA.SET_COR_FUNDO(COR_FUNDO)
    EIXO.SET_COR_FUNDO(COR_FUNDO)
    EIXO.SET_CORES_TICKS_EIXO_X('white')
    EIXO.SET_CORES_TICKS_EIXO_Y('white')
    EIXO.SET_COR_SPINES('left', 'white')
    EIXO.SET_COR_SPINES('bottom', 'white')
    EIXO.ESCONDER_SPINES('right', 'top')

    GRAFICO_ATUAL = EMBEDAR_GRAFICO_NO_TKINTER(FIGURA, TELA_RELATORIO)
    EXIBIR_COMPONENTE GRAFICO_ATUAL
    GRAFICO_ATUAL.DESENHAR()
FIM FUNCAO

FUNCAO CONFIRMAR_ABRIR_SOLICITACAO_SERVICO()
    TITULO = OBTER_VALOR CAMPO_SR_TITULO
    DESCRICAO = OBTER_VALOR CAIXA_TEXTO_SR_DESCRICAO
    LOCAL = OBTER_VALOR COMBOBOX_SR_LOCAL
    CATEGORIA = OBTER_VALOR COMBOBOX_SR_CATEGORIA
    TECNICO = OBTER_VALOR COMBOBOX_SR_TECNICO

    SE TITULO VAZIO OU DESCRICAO VAZIO OU LOCAL VAZIO OU CATEGORIA VAZIO OU TECNICO VAZIO ENTAO
        EXIBIR_MENSAGEM_STATUS_SR("ERRO: Preencha TODOS os campos para abrir a solicitação!", COR_VERMELHA)
        RETORNA
    FIM SE

    LIMPAR MENSAGEM_STATUS_SR

    ARMAZENAR_TEMPORARIAMENTE_SR {
        'titulo': TITULO,
        'descricao': DESCRICAO,
        'local': LOCAL,
        'categoria': CATEGORIA,
        'tecnico_atribuido': TECNICO
    }

    // Diálogo de confirmação
    DIALOGO_CONFIRMACAO = CRIAR_TOPLEVEL_DIALOGO(JANELA_PRINCIPAL, TITULO="Confirmar Abertura de Solicitação")
    CENTRALIZAR_DIALOGO(DIALOGO_CONFIRMACAO, JANELA_PRINCIPAL)
    DEFINIR_FOCO_DIALOGO(DIALOGO_CONFIRMACAO)

    ADICIONAR_LABEL(DIALOGO_CONFIRMACAO, TEXTO="Deseja confirmar a abertura deste chamado?")
    FRAME_BOTOES = ADICIONAR_FRAME(DIALOGO_CONFIRMACAO, TRANSPARENTE)
    ADICIONAR_BOTAO(FRAME_BOTOES, TEXTO="Sim", COMANDO=FINALIZAR_ABRIR_SOLICITACAO_SERVICO(DIALOGO_CONFIRMACAO))
    ADICIONAR_BOTAO(FRAME_BOTOES, TEXTO="Não", COMANDO=FECHAR_DIALOGO(DIALOGO_CONFIRMACAO))
FIM FUNCAO

FUNCAO FINALIZAR_ABRIR_SOLICITACAO_SERVICO(dialogo)
    FECHAR_DIALOGO(dialogo)

    TITULO = DADOS_SR_TEMPORARIOS.titulo
    DESCRICAO = DADOS_SR_TEMPORARIOS.descricao
    LOCAL = DADOS_SR_TEMPORARIOS.local
    CATEGORIA = DADOS_SR_TEMPORARIOS.categoria
    TECNICO = DADOS_SR_TEMPORARIOS.tecnico_atribuido
    NOVO_ID = GERAR_UUID_CURTO()

    CONEXAO = CONECTAR_BD()
    TENTAR:
        INSERIR EM 'solicitacoes_servico' (id, titulo, descricao, local, categoria, tecnico_atribuido, status)
        VALORES (NOVO_ID, TITULO, DESCRICAO, LOCAL, CATEGORIA, TECNICO, 'Aberta')
        CONEXAO.COMMIT()
        EXIBIR_MENSAGEM_STATUS_SR("Solicitação '{TITULO}' aberta com sucesso!", COR_VERDE)

        LIMPAR CAMPO_SR_TITULO
        LIMPAR CAIXA_TEXTO_SR_DESCRICAO
        LIMPAR COMBOBOX_SR_LOCAL
        LIMPAR COMBOBOX_SR_CATEGORIA
        LIMPAR COMBOBOX_SR_TECNICO

        DEFINIR_VALOR_BOTAO_SEGMENTADO_SR("Visualizar Solicitações")
        CHAMAR MOSTRAR_SECAO_SR("Visualizar Solicitações")
    EXCETO Erro_SQLite AS e:
        EXIBIR_MENSAGEM_STATUS_SR("Erro ao abrir solicitação: " + e, COR_VERMELHA)
        CONEXAO.ROLLBACK()
    FINALMENTE:
        CONEXAO.FECHAR()
FIM FUNCAO

FUNCAO PREENCHER_LISTA_SOLICITACOES_SERVICO()
    PARA CADA WIDGET EM LISTA_SOLICITACOES_FRAME:
        DESTRUIR WIDGET
    FIM PARA

    CONEXAO = CONECTAR_BD()
    SOLICITACOES = CONSULTAR CONEXAO 'SELECT id, titulo, descricao, local, categoria, tecnico_atribuido, status FROM solicitacoes_servico ORDER BY id DESC'
    CONEXAO.FECHAR()

    SE SOLICITACOES ESTIVER VAZIA ENTAO
        ADICIONAR_LABEL(LISTA_SOLICITACOES_FRAME, TEXTO="Nenhuma solicitação de serviço aberta.", ESTILO_ITALICO)
        RETORNA
    FIM SE

    PARA CADA SOLICITACAO EM SOLICITACOES:
        FRAME_SOLICITACAO = ADICIONAR_FRAME(LISTA_SOLICITACOES_FRAME, COR_TRANSPARENTE, BORDA_CINZA)
        FRAME_SOLICITACAO.EMPACOTAR(PADDING_Y=5, PREENCHER='x', EXPANDIR=VERDADEIRO)

        ADICIONAR_LABEL(FRAME_SOLICITACAO, TEXTO="ID: " + SOLICITACAO.id, ESTILO_NEGRITO).EMPACOTAR(ANCORA='nw')
        ADICIONAR_LABEL(FRAME_SOLICITACAO, TEXTO="Título: " + SOLICITACAO.titulo, ESTILO_NEGRITO).EMPACOTAR(ANCORA='nw')
        ADICIONAR_LABEL(FRAME_SOLICITACAO, TEXTO="Local: " + SOLICITACAO.local + " | Categoria: " + SOLICITACAO.categoria).EMPACOTAR(ANCORA='nw')
        ADICIONAR_LABEL(FRAME_SOLICITACAO, TEXTO="Técnico: " + SOLICITACAO.tecnico_atribuido + " | Status: " + SOLICITACAO.status).EMPACOTAR(ANCORA='nw')

        ADICIONAR_BOTAO(FRAME_SOLICITACAO, TEXTO="Ver Detalhes", COMANDO=MOSTRAR_DETALHES_SOLICITACAO_SERVICO(SOLICITACAO)).EMPACOTAR(ANCORA='se')
    FIM PARA

    ATUALIZAR_EXIBICAO_ROLAGEM(LISTA_SOLICITACOES_FRAME)
FIM FUNCAO

FUNCAO MOSTRAR_DETALHES_SOLICITACAO_SERVICO(dados_solicitacao)
    ID_SOLICITACAO_ATUAL = dados_solicitacao.id

    DEFINIR_TEXTO LABEL_SR_DETALHES_ID COM "ID: " + dados_solicitacao.id
    DEFINIR_TEXTO LABEL_SR_DETALHES_TITULO COM "Título: " + dados_solicitacao.titulo
    HABILITAR_EDICAO CAIXA_TEXTO_SR_DETALHES_DESCRICAO
    LIMPAR CAIXA_TEXTO_SR_DETALHES_DESCRICAO
    INSERIR_TEXTO CAIXA_TEXTO_SR_DETALHES_DESCRICAO dados_solicitacao.descricao
    DESABILITAR_EDICAO CAIXA_TEXTO_SR_DETALHES_DESCRICAO
    DEFINIR_TEXTO LABEL_SR_DETALHES_LOCAL COM "Local: " + dados_solicitacao.local
    DEFINIR_TEXTO LABEL_SR_DETALHES_CATEGORIA COM "Categoria: " + dados_solicitacao.categoria
    DEFINIR_TEXTO LABEL_SR_DETALHES_TECNICO COM "Técnico Atribuído: " + dados_solicitacao.tecnico_atribuido
    DEFINIR_TEXTO LABEL_SR_DETALHES_STATUS COM "Status: " + dados_solicitacao.status

    CHAMAR MOSTRAR_TELA(TELA_SR_DETALHES)
FIM FUNCAO

FUNCAO EXCLUIR_SOLICITACAO_SERVICO()
    SE NAO ID_SOLICITACAO_ATUAL EXISTE ENTAO
        RETORNA
    FIM SE

    CONFIRMAR_EXCLUSAO = EXIBIR_MENSAGEM_CAIXA(TITULO="Confirmar Exclusão", MENSAGEM="Tem certeza que deseja excluir a solicitação ID: " + ID_SOLICITACAO_ATUAL + "?", ICONE="warning", OPCAO_1="Não", OPCAO_2="Sim")

    SE CONFIRMAR_EXCLUSAO == "Sim" ENTAO
        CONEXAO = CONECTAR_BD()
        TENTAR:
            EXECUTAR CONEXAO 'DELETE FROM solicitacoes_servico WHERE id = ?' COM (ID_SOLICITACAO_ATUAL)
            CONEXAO.COMMIT()
            EXIBIR_MENSAGEM_CAIXA(TITULO="Sucesso", MENSAGEM="Solicitação ID: " + ID_SOLICITACAO_ATUAL + " excluída com sucesso!", ICONE="info")
            ID_SOLICITACAO_ATUAL = NULO
            CHAMAR VOLTAR_PARA_SOLICITACOES_PRINCIPAL()
        EXCETO Erro_SQLite AS e:
            EXIBIR_MENSAGEM_CAIXA(TITULO="Erro", MENSAGEM="Erro ao excluir solicitação: " + e, ICONE="cancel")
            CONEXAO.ROLLBACK()
        FINALMENTE:
            CONEXAO.FECHAR()
    FIM SE
FIM FUNCAO

FUNCAO MOSTRAR_SECAO_SR(nome_secao)
    SE nome_secao == "Visualizar Solicitações" ENTAO
        OCULTAR_COMPONENTE SECAO_ABRIR_NOVA_SOLICITACAO
        EXIBIR_COMPONENTE SECAO_VISUALIZAR_SOLICITACOES
        CHAMAR PREENCHER_LISTA_SOLICITACOES_SERVICO()
    SENAO // "Abrir Nova Solicitação"
        OCULTAR_COMPONENTE SECAO_VISUALIZAR_SOLICITACOES
        EXIBIR_COMPONENTE SECAO_ABRIR_NOVA_SOLICITACAO
        LIMPAR CAMPO_SR_TITULO
        LIMPAR CAIXA_TEXTO_SR_DESCRICAO
        LIMPAR COMBOBOX_SR_LOCAL
        LIMPAR COMBOBOX_SR_CATEGORIA
        LIMPAR COMBOBOX_SR_TECNICO
        LIMPAR MENSAGEM_STATUS_SR
    FIM SE
FIM FUNCAO

FUNCAO AO_FECHAR_JANELA()
    SE EXIBIR_MENSAGEM_CAIXA(TITULO="Sair?", MENSAGEM="Tem certeza que deseja sair?", ICONE="question", OPCAO_1="Não", OPCAO_2="Sim") == "Sim" ENTAO
        JANELA_PRINCIPAL.DESTRUIR()
    FIM SE
FIM FUNCAO


// Seção 6: Criação da Interface Gráfica (Estrutura Principal)
INICIO INTERFACE_GRAFICA
    JANELA_PRINCIPAL = CRIAR_JANELA_APLICATIVO()
    JANELA_PRINCIPAL.SET_TITULO('Sistema Modular de Monitoramento Energético')
    JANELA_PRINCIPAL.MAXIMIZAR_JANELA()
    REGISTRAR_EVENTO_FECHAR_JANELA(AO_FECHAR_JANELA)
FIM INTERFACE_GRAFICA


// Seção 7: Estrutura das Telas (Frames)

// TELA_LOGIN
CRIAR TELA_LOGIN NO JANELA_PRINCIPAL
    ADICIONAR TITULO "Acesso ao Sistema"
    ADICIONAR CAMPO_USUARIO (placeholder="Digite seu usuário")
    ADICIONAR CAMPO_SENHA (placeholder="Digite sua senha", tipo_oculto="*")
    ADICIONAR BOTAO "Login" (comando=VALIDAR_LOGIN)
    ADICIONAR LABEL RESPOSTA_LOGIN

// TELA_SETORES
CRIAR TELA_SETORES NO JANELA_PRINCIPAL
    ADICIONAR TITULO "Selecione uma Opção"
    CRIAR FRAME_BOTOES_SETORES (rolável)
    ADICIONAR BOTAO "Solicitações de Serviço" (comando=IR_PARA_SOLICITACOES_SERVICO) AO FRAME_BOTOES_SETORES
    FUNCAO PREENCHER_TELA_SETORES():
        LIMPAR BOTOES DO FRAME_BOTOES_SETORES (EXCETO "Solicitações de Serviço")
        CONEXAO = CONECTAR_BD()
        SETORES = CONSULTAR CONEXAO 'SELECT nome FROM setores ORDER BY nome'
        CONEXAO.FECHAR()
        PARA CADA SETOR EM SETORES:
            ADICIONAR BOTAO (texto=SETOR.nome, comando=SELECIONAR_SETOR(SETOR.nome)) AO FRAME_BOTOES_SETORES
    ADICIONAR BOTAO "Sair" (comando=AO_FECHAR_JANELA)

// TELA_DISPOSITIVOS
CRIAR TELA_DISPOSITIVOS NO JANELA_PRINCIPAL
    ADICIONAR TITULO "Selecione um Dispositivo"
    ADICIONAR LABEL LABEL_SETOR_ATUAL
    CRIAR FRAME_BOTOES_DISPOSITIVOS (rolável)
    FUNCAO PREENCHER_TELA_DISPOSITIVOS():
        LIMPAR BOTOES DO FRAME_BOTOES_DISPOSITIVOS
        SE SETOR_ATUAL EXISTE ENTAO
            ATUALIZAR LABEL_SETOR_ATUAL COM "Setor: " + SETOR_ATUAL
            CONEXAO = CONECTAR_BD()
            DISPOSITIVOS_NO_SETOR = CONSULTAR CONEXAO 'SELECT id, nome, info FROM dispositivos WHERE setor_id = (SELECT id FROM setores WHERE nome = ?)' COM (SETOR_ATUAL)
            CONEXAO.FECHAR()
            SE NAO DISPOSITIVOS_NO_SETOR EXISTE ENTAO
                ADICIONAR LABEL "Nenhum dispositivo neste setor." AO FRAME_BOTOES_DISPOSITIVOS
            SENAO
                PARA CADA DISPOSITIVO EM DISPOSITIVOS_NO_SETOR:
                    ADICIONAR BOTAO (texto=DISPOSITIVO.nome, comando=SELECIONAR_DISPOSITIVO(DISPOSITIVO)) AO FRAME_BOTOES_DISPOSITIVOS
        SENAO
            ATUALIZAR LABEL_SETOR_ATUAL COM "Nenhum setor selecionado."
    ADICIONAR BOTAO "Voltar" (comando=VOLTAR_PARA_SETORES)

// TELA_RELATORIO
CRIAR TELA_RELATORIO NO JANELA_PRINCIPAL
    ADICIONAR TITULO "Relatório do Dispositivo"
    ADICIONAR LABEL LABEL_DISPOSITIVO_ATUAL
    ADICIONAR CAIXA_TEXTO CAIXA_TEXTO_RELATORIO
    FUNCAO PREENCHER_TELA_RELATORIO():
        SE GRAFICO_ATUAL EXISTE ENTAO
            DESTRUIR GRAFICO_ATUAL
            GRAFICO_ATUAL = NULO
        EXIBIR_COMPONENTE CAIXA_TEXTO_RELATORIO
        SE DISPOSITIVO_ATUAL EXISTE ENTAO
            ATUALIZAR LABEL_DISPOSITIVO_ATUAL COM "Dispositivo: " + DISPOSITIVO_ATUAL.nome
            LIMPAR CAIXA_TEXTO_RELATORIO
            INSERIR_TEXTO CAIXA_TEXTO_RELATORIO DISPOSITIVO_ATUAL.info
        SENAO
            ATUALIZAR LABEL_DISPOSITIVO_ATUAL COM "Nenhum dispositivo selecionado."
            LIMPAR CAIXA_TEXTO_RELATORIO
            INSERIR_TEXTO CAIXA_TEXTO_RELATORIO "Selecione um dispositivo para ver seu relatório."
    CRIAR FRAME_BOTOES_RELATORIO (transparente)
        ADICIONAR BOTAO "Filtrar Dados" (comando=FILTRAR_DADOS) AO FRAME_BOTOES_RELATORIO
        ADICIONAR BOTAO "Consultar Dados" (comando=CONSULTAR_DADOS) AO FRAME_BOTOES_RELATORIO
        ADICIONAR BOTAO "Gerar Relatório" (comando=GERAR_RELATORIO) AO FRAME_BOTOES_RELATORIO
        ADICIONAR BOTAO "Ver Gráfico" (comando=MOSTRAR_GRAFICO) AO FRAME_BOTOES_RELATORIO
    ADICIONAR BOTAO "Voltar" (comando=VOLTAR_PARA_DISPOSITIVOS)

// TELA_SOLICITACOES
CRIAR TELA_SOLICITACOES NO JANELA_PRINCIPAL
    ADICIONAR TITULO "Gerenciar Solicitações de Serviço"
    CRIAR BOTAO_SEGMENTADO_SR ("Visualizar Solicitações", "Abrir Nova Solicitação") (comando=MOSTRAR_SECAO_SR)
    CRIAR SECAO_VISUALIZAR_SOLICITACOES (Frame rolável para lista de solicitações)
    CRIAR SECAO_ABRIR_NOVA_SOLICITACAO (Frame para formulário de nova solicitação)
        ADICIONAR CAMPO_ENTRADA CAMPO_SR_TITULO
        ADICIONAR CAIXA_TEXTO CAIXA_TEXTO_SR_DESCRICAO
        ADICIONAR COMBOBOX COMBOBOX_SR_LOCAL (opcoes de CARREGAR_LOCAIS_SERVICO())
        ADICIONAR COMBOBOX COMBOBOX_SR_CATEGORIA (opcoes de CARREGAR_CATEGORIAS_SERVICO())
        ADICIONAR COMBOBOX COMBOBOX_SR_TECNICO (opcoes de CARREGAR_TECNICOS_DISPONIVEIS())
        ADICIONAR BOTAO "Abrir Solicitação" (comando=CONFIRMAR_ABRIR_SOLICITACAO_SERVICO)
        ADICIONAR LABEL LABEL_SR_STATUS
    ADICIONAR BOTAO "Voltar" (comando=VOLTAR_PARA_SETORES)

// TELA_SR_DETALHES
CRIAR TELA_SR_DETALHES NO JANELA_PRINCIPAL
    ADICIONAR TITULO "Detalhes da Solicitação de Serviço"
    ADICIONAR LABEL LABEL_SR_DETALHES_ID
    ADICIONAR LABEL LABEL_SR_DETALHES_TITULO
    ADICIONAR CAIXA_TEXTO CAIXA_TEXTO_SR_DETALHES_DESCRICAO (somente leitura)
    ADICIONAR LABEL LABEL_SR_DETALHES_LOCAL
    ADICIONAR LABEL LABEL_SR_DETALHES_CATEGORIA
    ADICIONAR LABEL LABEL_SR_DETALHES_TECNICO
    ADICIONAR LABEL LABEL_SR_DETALHES_STATUS
    ADICIONAR BOTAO "Excluir Solicitação" (comando=EXCLUIR_SOLICITACAO_SERVICO)
    ADICIONAR BOTAO "Voltar" (comando=VOLTAR_PARA_SOLICITACOES_PRINCIPAL)


// Seção 8: Inicialização do Aplicativo
INICIO APP
    CHAMAR CONFIGURAR_BANCO_DE_DADOS()
    CHAMAR PREENCHER_TELA_SETORES()
    CHAMAR MOSTRAR_TELA(TELA_LOGIN)
    INICIAR_LOOP_PRINCIPAL_APLICATIVO()
FIM APP